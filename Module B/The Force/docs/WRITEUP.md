# Writeup

Разделим задание на основные этапы.

## Работа с изображениями

После получения архива, распаковываем его.

Получаем 6 изображений. Одно изображение — Дарт Вейдер, пять — имперские штурмовики.

В содержимом архива мы также обнаружим текстовый файл со стихотворением: 

“ПЯТЕРО СЛУГ ЛОРДА В ТЕНИ СТОЯТ
И МРАК ПОГЛОЩАЕТ ИХ СЕКРЕТ
«НАЙДИ, КОЛЬ ОСМЕЛИШЬСЯ», — ОНИ ГОВОРЯТ.
— «И ЛОРД ПОКАЖЕТ, ГДЕ СКРЫТ ТВОЙ ОТВЕТ”. 

Это подсказка. 

Согласно ей, мы можем предположить два факта:
1. Нам необходимо собрать что-то вместе;
2. Нам нужно смотреть куда-то внутрь.

На основании этих фактов мы видим логичным посмотреть, что есть интересного во всех изображениях, что мы извлекли из архива. 

Для этого нам необходимо использовать следующие утилиты:
- `exiftool`. В одном из изображений находится ключ. Дешифруем и сохраняем для дальнейшего использования.
- `steghide`. Две части бинарного файла скрыты через steghide (без пароля)
- `binwalk`. Две части бинарного файла скрыты простым concatenation

## Работа с бинарными файлами

Предположим, что мы успешно справились с предыдущим этапом. В одной директории у нас лежат 4 бинарных файла, которые выдают ошибку при попытке их запуска, файл `make_force`, а также нами был сохранён ключ из exif.

> Файл `make_force` склеивает четыре части бинарника по уникальным сигнатурам и формирует итоговый исполняемый файл — FORCE.

Запускаем файл `make_force`. В директории появляется файл FORCE. Запускаем его.

Дальнейший сценарий прохождения таска разветвляется на два направления.
1. Если нам повезёт (5% шанс), то мы пропустим этап с головоломкой и просто почитаем анекдоты по Star Wars, а затем получим свой флаг.
2. Если нам не повезёт, то нам придётся разгадывать головоломку и лишь после этого мы получим флаг.

Рассмотрим именно второй сценарий, ибо первый не представляет для нас ценности. 

Если мы попадаем на второй сценарий, то получаем в результате несколько намёков и подсказок на то, в каком направлении копать дальше. Затем в консоли появляется таймер в 20 минут (10, если мы попытались обойти систему), ограничивающий для нас время прохождения данного этапа

Опишем конкретные подсказки, которые нами будут получены:
- `чтобы терминал стал рассылать в эфир ключ от себя самого же.`. Флаг передаётся по воздуху.
- `\"Тот, чьё дыхание слышно издалека\"`. Намёк на то, какой ключ для XOR у реального ключа. 

## Работа с сетью
Исходя из полученных нами подсказок, видим логичным начать проверять все возможные сетевые протоколы на предмет подозрительной активности. Мы проверяли протокол UDP.

После некоторого времени мониторинга и изучения получаемых данных, замечаем, что через сеть с некоторой периодичностью ходит на случайные адреса UDP-пакет с полезной нагрузкой в виде зашифрованной в base64 строки.

Тут кроется ловушка: не каждый из отправляемых ключей является валидным ключом. Но отличить фейки от реального ключа просто: фейки - это просто "переговоры" штурмовиков между собой. Реальный ключ - это конкретная строка в l33t sp34k

Дальнейший шаг для нас, после получения реального ключа - это расшифровать его. Исходя из уже полученных подсказок, сначала мы применяем base64 дешифрование, а затем — XOR со строкой “DARTHVADER”.

В конечном итоге мы получаем искомый флаг.
