# Механики

По механике - обычный pcap-дамп.

Шум (фальшивый трафик).

Реальный трафик (zip), перемешанный в случайном порядке и смешанный с мусорным udp трафиком такого же размера (по чанкам).

И sip / rtp соединения рыцарей друг с другом.

Начинает всегда Король Артур. Заканчивает всегда Галахад. Следующая точка назначения Галахада - "пустота", "всем" - "0.0.0.0".

Каждый из персонажей через rtp шлёт номер своего чанка.

Вместе с Королём Артуром начинает также и Мордред. Он также шлёт номер своего чанка, шлёт его тому же, кому и Король Артур - но его чанк "отравленный". Если начать собирать итоговый файл с Мордреда - весь таск будет провален.

Нужно собрать цепь взаимодействий с номерами чанков, которые персонажи называют.

Каждый номер чанка - номер "src_port" у соответствующего UDP-стрима.

Каждый такой udp стрим нужно выгрузить в правильном порядке (цепь взаимодействий). Потом - просто объединить в один единый zip-файл.

Второй этап представляет собой многослойный (15 уровней) zip архив.

Каждый этаж (0-14) - это OSINT-загадка на знание мира легенд и мифов о Короле Артуре. Загадки сложные, для их решения необходимо серьёзно погружаться в источники (за основу была взята книга сэра Мэллори "Смерть Артура").

Структура каждого этажа (0-14):

- `sacred_scroll.txt`. Это OSINT-загадка.
- `graveure_INDEX.jpg`. Это связанная с текущим этажом картина с персонажем текущего этажа (вступительная картина с рыцарем, проходящим посвящение, 12 рыцарей, Мерлин, Мордред).
- `next_trial.zip`. Следующий уровень. Ключ - ответ на OSINT-загадку.

Структура 15-го этажа (финал):

- `graveure_15.jpg`. Внутри через steghide спрятан бонус. Ключ - строка с флагом. Внутри спрятан ещё более сложный шифр, которым закодировано послание от автора.
- `sacred_scroll.txt`. Внутри - приветствие смельчака, который сумел дойти до финала. И последнее испытание - зашифрованный флаг.

Поговорим о двух финальных шифрах.

1. Флаг.
Для начала, приведём тут таблицу (неупорядоченную, часть испытания):
╒═══════════╕
│  Symbols  │
╞═══════════╡
│  GALAHAD  │
├───────────┤
│ PERCIVAL  │
├───────────┤
│ TRISTRAM  │
├───────────┤
│  LAMORAK  │
├───────────┤
│ BEDIVERE  │
├───────────┤
│  MERLIN   │
├───────────┤
│  GARETH   │
├───────────┤
│ LANCELOT  │
├───────────┤
│   KING    │
├───────────┤
│   YWAIN   │
├───────────┤
│ AGRAVAIN  │
├───────────┤
│  GAWAIN   │
├───────────┤
│   BORS    │
╘═══════════╛

Также, укажем специальный оператор - "MORDRED".

Пример (строка "HELLO" на "KnightsCipher"):
`GAWAIN_GARETH_EXCALIBUR_GAWAIN_PERCIVAL_EXCALIBUR_GAWAIN_GALAHAD_EXCALIBUR_GAWAIN_GALAHAD_EXCALIBUR_GAWAIN_MORDRED_MERLIN`

Суть шифра - кастомная шестнадцатеричка, но с недостающей до 16-ти длиной алфавита. MORDRED это исправляет - если значение выходит за пределы 16, то значение рыцаря переводится в двоичную систему и инвертируется. Перед инвертированным рыцарем ставится строка MORDRED.

Каждый байт разбивается на полубайты. Каждый полубайт маппится на соответствующего ему рыцаря. Если нет соответствия - полубайт инвертируется, снова маппится, затем перед ним ставится "MORDRED".

Два полубайта разбиваются при помощи символа "EXCALIBUR".

В целом - эта вся суть шифра.

2. Бонус.

Суть осталась та же, что и в предыдущем шифре. Единственное отличие - добавление оператора "GRAIL".

Пример  (строка "HELLO" на "GrailKnightsCipher"):
`GRAIL_GARETH_EXCALIBUR_GAWAIN_PERCIVAL_EXCALIBUR_GAWAIN_GALAHAD_EXCALIBUR_GAWAIN_GRAIL_EXCALIBUR_GAWAIN_MORDRED_GRAIL_EXCALIBUR_1011_GAWAIN_EXCALIBUR_GALAHAD_MERLIN`

Суть оператора GRAIL заключается в том, что:

1. Случайным образом выбирается один из символов для "вознесения".
2. Этот символ сохраняется в список.
3. На место вознесённого символа помещается GRAIL
4. В конце, после основной кодировки, этот символ добавляется в самый конец зашифрованного сообщения.
5. Если количество "вознесённых" не делится на 2, то слева (в начало списка "вознесённых") добавляется байт-заполнитель (Рыцарь).

Вознесённые помешаются в конец в порядке строго слева направо (сначала первый вознесённый, потом второй, третий и т.д.)
