# Механики

## Приготовления

Запускаем в фоновом асинхронном потоке периодическую (раз в секунду) проверку на то, не находится ли текущий процесс под отладкой. Проверка осуществляется простым способом: чтением /proc/self/status. Если обнаруживается другой процесс, который прицепился к нам в режиме отладки, то завершаем выполнение.

## Небо 

В начале этапа генерируем случайный валидный и незанятый ip-адрес v4 из локального пула адресов. 

Начинаем его время от времени пинговать с некоторой задержкой. 

Если хост с указанным адресом появляется в сети, то переходим к следующему шагу: пытаемся установить с ним соединение. 

Когда соединение оказывается установлено, то непрерывно и с некоторой задержкой отправляем на указанный адрес пейлоад с первой частью флага.

## Земля

Генерируем случайную папку в пределах домашней папки пользователя, к которой у нашего процесса есть доступ на запись и чтение. 

Создаём временный флаг с флагом O_TEMPFILE по указанному пути. Записываем внутрь флаг.

Файл не имеет имени в файловой системе и доступен только через файловый дескриптор в /proc/<pid>/fd/, пока процесс не завершён. Также стоит упомянуть, что флаг живёт в промежуток времени между "пробуждением принца" и до самого завершения процесса.

Запускаем сторожевой дочерний процесс, который следит за состоянием родительского процесса. Если родительский процесс заморожен, то дочерний процесс завершает его выполнение и завершается сам. 

